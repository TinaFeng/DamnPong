
<html>
	<head>
       <meta charset="utf-8">
        <title>Pong</title>

        <style>

            #ip {
                text-align: center;
                line-height: 45px;
                vertical-align: middle;
                
            }
            

            #name {
                text-align: center;
                line-height: 45px;
                vertical-align: middle;
            }

            #log {
                width: 300px;
                height: 400px;
            }


            canvas{
                position: absolute;
                margin:auto;
                top:0;
                bottom: 0;
                left:0;
                right: 0;
            }
        </style>
	</head>
    <body>
        Address:<input type="text" id="ip" name=" ip">
        <br />
        <br />
        Nickname: <input type="text" id="name" name="name">

        <input type="button" id="Play" name="Play" onclick="connect();" value="Play">
        <br />
        <br />
        <textarea id='log' name='log' readonly='readonly'></textarea><br />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="fancywebsocket.js"></script>
        <script>

            //^ style thing to make it on the center;
            var Server;

            var Connected = false;
            function log(text) {
                $log = $('#log');
                //Add text to log
                $log.append(($log.val() ? "\n" : '') + text);
                //Autoscroll
                $log[0].scrollTop = $log[0].scrollHeight - $log[0].clientHeight;
            }


            function send(text) {
                Server.send('message', text);
            }

            function connect() {

                if (document.getElementById('ip').value != ''&& document.getElementById('name').value != '') //if IP and name are not empty
                {
              

                    log('Connecting...');
                    Server = new FancyWebSocket('ws://' + document.getElementById('ip').value + ':' + 8000);


                    //Let the user know we're connected
                    Server.bind('open', function () {
                        document.getElementById("Play").disabled = true;
                        log("Connected.");
                        Connected = true;
                        main(); // don't start the game until connected
                    });

                    //OH NOES! Disconnection occurred.
                    Server.bind('close', function (data) {
                        document.getElementById("Play").disabled = false;
                        log("Disconnected.");
                    });

                    //Log any messages sent from server
                    Server.bind('message', function (payload) {
                        log(payload);
                        //Payload is the whole string, Server_Location is data for individual object(ball, then player1, future players etc split by ";")
                        Server_Location = payload.split(";");
                    
                    });

                    Server.connect();
                }
                else
                {
                    log("IP or Nickname cannot be empty.");
                }
      
            }

            //server stuff ^
            var WIDTH = 600, HEIGHT = 600, pi = Math.PI;
            var canvas, context, keystate;
            var player_T, ball;

            var speed = 10;
            //moving keys (only top)
            var LeftArrow = 37, RightArrow = 39;

            var Server_Location;
            var Plauer_Location;
            player_T = {
                x: null,
                y: null,
                width : 100,
                height :20,

                update: function () {
                    if (keystate[LeftArrow]) {
                  //      this.x -= speed;
                        send('02');

                    }
                    else if (keystate[RightArrow]) {


               //         this.x += speed;
                        send('00');
                    }
                },
                draw: function () {  //300,300;45,290
                    context.fillStyle = 'red';
                    Player_Location = Server_Location[1].split(","); // spliting player1 x y
                    //index will change depends on which side the paddle is
                    context.fillRect(Player_Location[1], Player_Location[0], this.width, this.height);


                }
            };
            //player_B = {
            //    x: null,
            //    y: null,
            //    width: 100,
            //    height: 20,

            //    update: function () {

            //    },
            //    draw: function () {
            //        context.fillStyle = 'blue';
            //        context.fillRect(this.x, this.y, this.width, this.height);


            //    }
            //};
            //player_L = {
            //    x: null,
            //    y: null,
            //    width: 100,
            //    height: 20,

            //    update: function () { },
            //    draw: function () {
            //        context.fillRect(this.x, this.y, this.width, this.height);
            //    }
            //};
            //player_R = {
            //    x: null,
            //    y: null,
            //    width: 100,
            //    height: 20,

            //    update: function () { },
            //    draw: function () {
            //        context.fillRect(this.x, this.y, this.width, this.height)
            //    }
            //};
            ball = {
                x: null,
                y: null,
                velocity: null,
                radius: 10,
                speed: 5,
                update: function () {
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;

                    if (this.y <0 || this.y+this.radius > HEIGHT)
                    {
                        var offset = this.velocity.y < 0 ? 0 - this.y : HEIGHT - (this.y + this.radius);

                        //if ball is going up, offset is -position, if going down, offset is height - position+radius
                        this.y += offset;

                        this.velocity.y *= -1;

                    }//if out of bound vertically, going back  //going to remove for actual game since no borders

                    if (this.x < 0 || this.x + this.radius > WIDTH) //horizontal
                    {
                        var offset = this.velocity.x < 0 ? 0 - this.x : WIDTH - (this.x + this.radius);

                        //if ball is going up, offset is -position, if going down, offset is height - position+radius
                        this.x += offset;

                        this.velocity.x *= -1;

                    }


                    var OnCollision = function (ax, ay, aw, ah, bx, by, bw, bh) {
                        return ax < bx + bw && ay < by + bh
                        && bx < ax + aw && by < ay + ah;//return if a position is smaller than
                    };

                    var paddle =player_T ;
                    if (OnCollision(paddle.x, paddle.y, paddle.width, paddle.height,
                            this.x, this.y, this.radius, this.radius)) //if ball collided with paddle
                    {

                        var hit_location = this.x+this.radius;

                        if (hit_location < paddle.x + paddle.width / 2) // if hit is on the left of paddle
                        {
                            this.velocity.y *= -1;
                            this.velocity.x = -5;

                        }



                        else if ((hit_location > paddle.x + paddle.width / 2)) //if hits on the right of paddle
                        {
                            this.velocity.y *= -1;
                            this.velocity.x = 5;
                        }

                        else // if hits on center
                        {
                            this.velocity.y *= -1;
                            this.velocity.x *= -1;
                        }
                    };


                },


                draw: function () {
                    context.fillRect(this.x, this.y, this.radius, this.radius);
                }

            };


            function main() {
                //legistics

          //
            //    log('Connecting...');




                //create the canvas
                canvas = document.createElement("canvas");
                canvas.width = WIDTH;
                canvas.height = HEIGHT;
                context = canvas.getContext("2d");
                document.body.appendChild(canvas);




                keystate = {};
                document.addEventListener("keydown", function (evt) {
                    keystate[evt.keyCode] = true;

                });
                document.addEventListener("keyup", function (evt) {
                    delete keystate[evt.keyCode];
                });

                init();

                var loop = function () {
                    update();
                    draw();

                    window.requestAnimationFrame(loop, canvas);
                };
                window.requestAnimationFrame(loop, canvas);
            }

            function init() { //on start
                //top

                player_T.x = (WIDTH / 2) - (player_T.width / 2);
                player_T.y = (player_T.height);

                //bottom
                //player_B.x = (WIDTH / 2) - (player_B.width / 2);
                //player_B.y = HEIGHT - (player_B.height*2);



                ball.x = (WIDTH/ 2)-ball.x;
                ball.y = (HEIGHT / 2) - ball.y;

                ball.velocity = {
                    x: 0,
                    y: -5
                };
            }


            function update() {
                player_T.update();
                ball.update();
            }
            function draw() {

                //background size and color
                context.fillRect(0, 0, WIDTH, HEIGHT);
                context.save();
                context.fillStyle = "#fff";

                //objects
                ball.draw();
                player_T.draw();
            //    player_B.draw();
                context.restore();
            }

            
         
        </script>
    </body>
</html>